---
title: Exploiting Cloud Object Storage for High-Performance Analytics
date: 2024-10-10 20:00:00 +0800
categories: [Tech, 论文阅读笔记]
tags: [Paper]      
description: 慕尼黑工业大学（TUM）2023 年 7 月发表在 PVLDB的论文： 利用对象存储进行高性能数据分析
author: Payne
mermaid: true
---

> ByteHouse，Greptime都借鉴了该论文的设计。原文参考[这里](https://www.vldb.org/pvldb/vol16/p2769-durner.pdf)。
> 

## abstract

弹性计算和存储对分析性云原生数据库系统至关重要。原本由于网络IO的延迟，不可避免地需要处理本地的大量数据。但随着NVMe和网络IO性能的接近，云存储更适合存储大量数据。

本文提出了使用云存储上执行分析的架构。为了实现高性能的检索，本文提出了*AnyBlob*，一个用于新型的下载管理器，用于优化查询引擎的吞吐量，降低CPU的使用率，并在数据库系统*Umbra*中演示之。

## Introduction

云对象存储存储几乎无限容量，且可以保证极高的数据可用性。2018年之后AWS推出了100 Gbit/s（≈12GB/s）带宽的对象存储，缩小了与NVMe的带宽差距。这对实现带宽依赖为主的数据应用（分析型业务）尤为重要。

文中认为有三个挑战：

- 充分利用（achieving）带宽：因为单对象的请求延迟较高，要使高带宽网络达到饱和状态需要许多并发请求。因此，DBMS需要非常谨慎地设计网络读写方式才可以充分利用网络优化实例上的可用带宽；
- 存在网络CPU额外开销：与从本地磁盘获取数据相比，网络检索有更高的 CPU 开销。
- 多云支持：许多云数据库系统能够在不同的云平台上运行，允许用户选择他们喜欢的供应商。与多云系统的需求相反，每个云供应商都提供自己的网络库。因此，必须集成多个库，这增加了系统的复杂性。

作者开发了一个能够从多个云供应商获取数据的下载管理器，并将高带宽对象检索无缝集成到数据库引擎的扫描操作符中。DBMS *Umbra*，配备了下载管理器并禁用缓存，在单个实例（这里实例指的是计算实例）上的性能与当前最先进的云数据库系统的大规模配置相当，而这些系统将数据缓存到本地SSD上。快速、低开销的网络集成消除了实例切换时的性能骤降。

文中总结了三个贡献：

- 云对象存储的实验研究：为了实现高带宽数据处理，文中研究了云对象存储的特性。在第 2 节中，我们解释了分离式存储的设计，讨论了其成本结构，并提供了关于不同对象存储的延迟和吞吐量的详细实验。我们**定义了一个最优请求大小范围，以在最大化吞吐量的同时最小化成本**。我们的并发分析有助于安排足够的请求，以达到吞吐量目标（即实例带宽）；
- AnyBlob，一个高性能的多云对象存储下载管理器，专为大数据分析优化：第 3 节中描述的*AnyBlob*，能够在显著减少CPU资源消耗的情况下，达到与云供应商提供的库相同的吞吐量。CPU资源利用率对于并发处理数据至关重要。与现有解决方案不同，我们的方法不需要为并行请求启动新线程，因为它使用了`io_uring`，这简化了异步系统调用。根据我们的分析，要充分利用网络带宽，必须同时保持数百个请求处于进行中状态。我们的解决方案有助于减少线程调度的开销，并允许与数据库查询引擎无缝集成；
- 集成检索的大致框架。将下载管理器与数据库引擎紧密集成，使得在分离式存储上实现高效分析成为可能。在第 4 节中，我们提出了将*AnyBlob*集成到数据库引擎中的蓝图。通过精心设计的扫描操作符和开发的对象检索调度器，我们可以将对象的下载与分析处理无缝交错进行。

## 云对象存储特性

为了设计一个基于云对象存储的高效分析引擎，我们需要了解其基本特性。我们首先分析分离式对象存储和计算实例的**性能特性及成本**。

为了深入了解存储架构，我们在AWS S3和其他两家云提供商上进行了各种微实验，以理解延迟和吞吐量的限制。

### 对象存储产品设计架构

对象存储降数据以对象形式存储，这些对象在多个存储服务器上分布和复制，以确保可用性和持久性。在解析云对象存储的域名后，用户从存储服务器请求一个对象，该服务器随后发送数据。所有主要云提供商都使用类似的API，通过**HTTP**（TCP）传输数据。

> 国内三大云厂商（Ali/tx/hw）都是用的http.

对象存储中数据存储在类似硬盘分区的**存储桶**中。根据AWS的说法，S3对所有前缀进行分区，以支持每秒成千上万的请求。对象存储服务会复制数据，保证数据的强一致性，可用性和持久性。

数据访问性能受实例（和上文相同，这里指计算实例）的网络连接、云存储的网络连接以及网络本身（比如两者不在一个内网等等）的影响。在AWS，通用实例对对象存储的带宽可达100 Gbit/s及以上。

### 对象存储费用开销

所有云厂商采用类似的定价方式，费用分为：
- 存储空间成本；
- 数据检索和修改成本（API成本，以调用次数为计费指标）；
- 区域间网络传输成本（按传输的流量计费，一般同区域的实例访问不计费）。

对比其他产品（比如块存储，云硬盘等），对象存储的空间，持久化和可用性性价比是最好的。

### 延迟/Latency



